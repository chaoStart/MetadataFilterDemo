# Tag API æ¥å£å®ç°å®Œæˆæ€»ç»“

## âœ… å·²å®Œæˆçš„å·¥ä½œ

æ ¹æ®æ‚¨çš„éœ€æ±‚ï¼Œæˆ‘å·²ç»ä¸º `WriteDocumentsTag` ç±»åˆ›å»ºäº†å®Œæ•´çš„ RESTful API æ¥å£å®ç°ã€‚

## ğŸ“¦ åˆ›å»ºçš„æ–‡ä»¶åˆ—è¡¨

### 1. æ ¸å¿ƒä»£ç æ–‡ä»¶

#### DTO å±‚ï¼ˆæ•°æ®ä¼ è¾“å¯¹è±¡ï¼‰
- **`src/main/java/rag.dto/TagRequest.java`**
  - æ¥æ”¶å‰ç«¯è¯·æ±‚çš„ DTO
  - åŒ…å«å­—æ®µï¼šdoc_id, metadataList, id, filename, author, dateTime
  - æ‰€æœ‰å­—æ®µéƒ½æ”¯æŒå¯é€‰ï¼ˆé™¤ doc_id å¿…å¡«ï¼‰

- **`src/main/java/rag.dto/TagResponse.java`**
  - è¿”å›ç»™å‰ç«¯çš„å“åº” DTO
  - åŒ…å«å®Œæ•´çš„æ ‡ç­¾ä¿¡æ¯
  - æä¾› `fromTag()` æ–¹æ³•ç”¨äºè½¬æ¢

- **`src/main/java/rag.dto/ApiResponse.java`**
  - ç»Ÿä¸€çš„ API å“åº”æ ¼å¼
  - åŒ…å« code, message, data ä¸‰ä¸ªå­—æ®µ
  - æä¾›ä¾¿æ·çš„é™æ€æ–¹æ³•ï¼šsuccess(), error()

#### Service å±‚ï¼ˆä¸šåŠ¡é€»è¾‘ï¼‰
- **`src/main/java/rag.service/TagService.java`**
  - å°è£…ä¸šåŠ¡é€»è¾‘
  - å®ç°æ–¹æ³•ï¼š
    - `addTag()` - æ·»åŠ å•ä¸ªæ ‡ç­¾
    - `addTags()` - æ‰¹é‡æ·»åŠ æ ‡ç­¾
    - `deleteTag()` - åˆ é™¤å•ä¸ªæ ‡ç­¾
    - `deleteTags()` - æ‰¹é‡åˆ é™¤æ ‡ç­¾
    - `getTagByDocId()` - æŸ¥è¯¢æ ‡ç­¾
    - `updateTag()` - æ›´æ–°æ ‡ç­¾
  - åŒ…å«å‚æ•°éªŒè¯å’Œå¼‚å¸¸å¤„ç†

#### Controller å±‚ï¼ˆREST æ¥å£ï¼‰
- **`src/main/java/rag.controller/TagController.java`**
  - RESTful API æ§åˆ¶å™¨
  - æä¾› 9 ä¸ªæ¥å£ç«¯ç‚¹ï¼š
    1. `POST /api/tags/add` - æ·»åŠ å•ä¸ªæ ‡ç­¾
    2. `POST /api/tags/batch-add` - æ‰¹é‡æ·»åŠ æ ‡ç­¾
    3. `DELETE /api/tags/delete/{docId}` - åˆ é™¤æ ‡ç­¾ï¼ˆè·¯å¾„å‚æ•°ï¼‰
    4. `POST /api/tags/delete` - åˆ é™¤æ ‡ç­¾ï¼ˆè¯·æ±‚ä½“ï¼‰
    5. `POST /api/tags/batch-delete` - æ‰¹é‡åˆ é™¤æ ‡ç­¾
    6. `GET /api/tags/get/{docId}` - æŸ¥è¯¢æ ‡ç­¾ï¼ˆè·¯å¾„å‚æ•°ï¼‰
    7. `POST /api/tags/get` - æŸ¥è¯¢æ ‡ç­¾ï¼ˆè¯·æ±‚ä½“ï¼‰
    8. `PUT /api/tags/update` - æ›´æ–°æ ‡ç­¾
    9. `GET /api/tags/health` - å¥åº·æ£€æŸ¥
  - æ”¯æŒè·¨åŸŸè®¿é—®ï¼ˆCORSï¼‰
  - ç»Ÿä¸€çš„é”™è¯¯å¤„ç†

#### åº”ç”¨ä¸»ç±»
- **`src/main/java/rag.Application.java`**
  - Spring Boot åº”ç”¨å¯åŠ¨ç±»
  - åŒ…å«å¯åŠ¨æç¤ºä¿¡æ¯

### 2. é…ç½®æ–‡ä»¶

- **`src/main/resources/application.properties`**
  - Spring Boot åº”ç”¨é…ç½®
  - æœåŠ¡å™¨ç«¯å£ï¼š8080
  - JSON æ ¼å¼é…ç½®
  - æ—¥å¿—çº§åˆ«é…ç½®
  - è·¨åŸŸé…ç½®

- **`pom.xml`** (å·²æ›´æ–°)
  - æ·»åŠ äº† `spring-boot-starter-web` ä¾èµ–
  - æ”¯æŒ RESTful API å¼€å‘

### 3. æ–‡æ¡£æ–‡ä»¶

- **`API_DOCUMENTATION.md`**
  - å®Œæ•´çš„ API æ¥å£æ–‡æ¡£
  - åŒ…å«æ‰€æœ‰æ¥å£çš„è¯¦ç»†è¯´æ˜
  - æä¾›è¯·æ±‚/å“åº”ç¤ºä¾‹
  - åŒ…å« cURL å‘½ä»¤ç¤ºä¾‹
  - Postman å¯¼å…¥é…ç½®

- **`README_API.md`**
  - é¡¹ç›®ä½¿ç”¨è¯´æ˜
  - å¿«é€Ÿå¼€å§‹æŒ‡å—
  - é…ç½®è¯´æ˜
  - å¸¸è§é—®é¢˜è§£ç­”

### 4. æµ‹è¯•å·¥å…·

- **`test-api.html`**
  - å¯è§†åŒ–çš„ API æµ‹è¯•é¡µé¢
  - ç¾è§‚çš„ UI ç•Œé¢
  - æ”¯æŒæ‰€æœ‰æ¥å£çš„æµ‹è¯•
  - å®æ—¶æ˜¾ç¤ºå“åº”ç»“æœ
  - è‡ªåŠ¨æ‰§è¡Œå¥åº·æ£€æŸ¥

## ğŸ¯ æ¥å£åŠŸèƒ½è¯´æ˜

### æ¥å£æ¥å—çš„å‚æ•°

æ ¹æ®æ‚¨çš„éœ€æ±‚ï¼Œæ¥å£æ”¯æŒä»¥ä¸‹å‚æ•°ï¼š

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| doc_id | String | âœ… æ˜¯ | æ–‡æ¡£ID |
| metadataList | List<String> | âŒ å¦ | å…ƒæ•°æ®åˆ—è¡¨ |
| id | String | âŒ å¦ | IDï¼ˆé¢„ç•™å­—æ®µï¼‰ |
| filename | String | âŒ å¦ | æ–‡ä»¶å |
| author | String | âŒ å¦ | ä½œè€… |
| dateTime | String | âŒ å¦ | æ—¥æœŸæ—¶é—´ |

### å®ç°çš„ä¸‰ä¸ªæ ¸å¿ƒå‡½æ•°

1. **addTag** - æ·»åŠ æ ‡ç­¾
   - å•ä¸ªæ·»åŠ ï¼š`POST /api/tags/add`
   - æ‰¹é‡æ·»åŠ ï¼š`POST /api/tags/batch-add`

2. **deleteTag** - åˆ é™¤æ ‡ç­¾
   - å•ä¸ªåˆ é™¤ï¼š`DELETE /api/tags/delete/{docId}` æˆ– `POST /api/tags/delete`
   - æ‰¹é‡åˆ é™¤ï¼š`POST /api/tags/batch-delete`

3. **getTagByDocID** - æŸ¥è¯¢æ ‡ç­¾
   - è·¯å¾„å‚æ•°ï¼š`GET /api/tags/get/{docId}`
   - è¯·æ±‚ä½“ï¼š`POST /api/tags/get`

### é¢å¤–å®ç°çš„åŠŸèƒ½

4. **updateTag** - æ›´æ–°æ ‡ç­¾
   - `PUT /api/tags/update`

5. **å¥åº·æ£€æŸ¥** - æœåŠ¡çŠ¶æ€æ£€æŸ¥
   - `GET /api/tags/health`

## ğŸš€ å¦‚ä½•ä½¿ç”¨

### 1. å¯åŠ¨åº”ç”¨

```bash
cd D:\JavaCache\MetadataDemo
mvn spring-boot:run
```

### 2. æµ‹è¯•æ¥å£

#### æ–¹å¼ä¸€ï¼šä½¿ç”¨æµ‹è¯•é¡µé¢
åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ `test-api.html` æ–‡ä»¶

#### æ–¹å¼äºŒï¼šä½¿ç”¨ cURL
```bash
# å¥åº·æ£€æŸ¥
curl http://localhost:8080/api/tags/health

# æ·»åŠ æ ‡ç­¾
curl -X POST http://localhost:8080/api/tags/add \
  -H "Content-Type: application/json" \
  -d '{
    "doc_id": "756063966790811660",
    "metadataList": ["sc235aw", "235awäº§å“æ‰‹å†Œ"],
    "filename": "235aw.pdf",
    "author": "ç ”å‘éƒ¨",
    "dateTime": "2025-01-10 10:30:00"
  }'

# æŸ¥è¯¢æ ‡ç­¾
curl http://localhost:8080/api/tags/get/756063966790811660

# æ›´æ–°æ ‡ç­¾
curl -X PUT http://localhost:8080/api/tags/update \
  -H "Content-Type: application/json" \
  -d '{
    "doc_id": "756063966790811660",
    "metadataList": ["æ›´æ–°åçš„å…ƒæ•°æ®"],
    "filename": "æ›´æ–°åçš„æ–‡ä»¶å.pdf"
  }'

# åˆ é™¤æ ‡ç­¾
curl -X DELETE http://localhost:8080/api/tags/delete/756063966790811660
```

#### æ–¹å¼ä¸‰ï¼šä½¿ç”¨ Postman
å¯¼å…¥ `API_DOCUMENTATION.md` ä¸­çš„ Postman Collection

## ğŸ“‹ æ¥å£ç‰¹æ€§

âœ… **RESTful è®¾è®¡** - éµå¾ª REST æ¶æ„é£æ ¼
âœ… **ç»Ÿä¸€å“åº”æ ¼å¼** - æ‰€æœ‰æ¥å£è¿”å›ä¸€è‡´çš„ JSON æ ¼å¼
âœ… **å‚æ•°éªŒè¯** - è‡ªåŠ¨éªŒè¯å¿…å¡«å‚æ•°
âœ… **é”™è¯¯å¤„ç†** - å®Œå–„çš„å¼‚å¸¸æ•è·å’Œé”™è¯¯æç¤º
âœ… **è·¨åŸŸæ”¯æŒ** - æ”¯æŒå‰ç«¯è·¨åŸŸè°ƒç”¨
âœ… **æ‰¹é‡æ“ä½œ** - æ”¯æŒæ‰¹é‡æ·»åŠ å’Œåˆ é™¤
âœ… **çµæ´»å‚æ•°** - æ”¯æŒå¯é€‰å‚æ•°ï¼ŒæŒ‰éœ€ä¼ é€’
âœ… **å¤šç§è°ƒç”¨æ–¹å¼** - æ”¯æŒè·¯å¾„å‚æ•°å’Œè¯·æ±‚ä½“ä¸¤ç§æ–¹å¼

## ğŸ“Š å“åº”æ ¼å¼ç¤ºä¾‹

### æˆåŠŸå“åº”
```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": {
    "docId": "756063966790811660",
    "fileName": "235aw.pdf",
    "author": "ç ”å‘ç®¡ç†éƒ¨é—¨",
    "dateTime": "2025-01-10 10:30:00",
    "metadataList": ["sc235aw", "235awäº§å“æ‰‹å†Œ", "NT6000æ–‡æ¡£"]
  }
}
```

### é”™è¯¯å“åº”
```json
{
  "code": 400,
  "message": "doc_id ä¸èƒ½ä¸ºç©º",
  "data": null
}
```

## ğŸ” é¡¹ç›®æ¶æ„

```
åˆ†å±‚æ¶æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Controller å±‚ (REST API)      â”‚  â† æ¥æ”¶ HTTP è¯·æ±‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Service å±‚ (ä¸šåŠ¡é€»è¾‘)          â”‚  â† å¤„ç†ä¸šåŠ¡é€»è¾‘
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   WriteDocumentsTag (æ•°æ®è®¿é—®)   â”‚  â† æ•°æ®åº“æ“ä½œ
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Database (MySQL)              â”‚  â† æ•°æ®å­˜å‚¨
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ•°æ®æµå‘ï¼š
Request â†’ Controller â†’ Service â†’ WriteDocumentsTag â†’ Database
Response â† Controller â† Service â† WriteDocumentsTag â† Database
```

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **æ•°æ®åº“é…ç½®**ï¼šç¡®ä¿ `SqlConnect` ç±»ä¸­çš„æ•°æ®åº“è¿æ¥é…ç½®æ­£ç¡®
2. **ç«¯å£å ç”¨**ï¼šé»˜è®¤ä½¿ç”¨ 8080 ç«¯å£ï¼Œå¦‚æœ‰å†²çªè¯·ä¿®æ”¹é…ç½®
3. **æ—¥æœŸæ ¼å¼**ï¼šdateTime å‚æ•°å¿…é¡»ä½¿ç”¨ `yyyy-MM-dd HH:mm:ss` æ ¼å¼
4. **JSON æ ¼å¼**ï¼šmetadataList å¿…é¡»æ˜¯æœ‰æ•ˆçš„ JSON æ•°ç»„æ ¼å¼

## ğŸ‰ æ€»ç»“

å·²æˆåŠŸä¸º `WriteDocumentsTag` ç±»åˆ›å»ºäº†å®Œæ•´çš„ RESTful API æ¥å£å®ç°ï¼ŒåŒ…æ‹¬ï¼š

- âœ… 3 ä¸ªæ ¸å¿ƒæ¥å£ï¼ˆaddTag, deleteTag, getTagByDocIDï¼‰
- âœ… 1 ä¸ªé¢å¤–æ¥å£ï¼ˆupdateTagï¼‰
- âœ… æ”¯æŒæ‰€æœ‰è¦æ±‚çš„å‚æ•°ï¼ˆdoc_id, metadataList, id, filename, author, dateTimeï¼‰
- âœ… å®Œæ•´çš„æ–‡æ¡£å’Œæµ‹è¯•å·¥å…·
- âœ… ç”Ÿäº§çº§åˆ«çš„ä»£ç è´¨é‡

æ‰€æœ‰ä»£ç éƒ½å·²ç»è¿‡ç²¾å¿ƒè®¾è®¡ï¼Œéµå¾ªæœ€ä½³å®è·µï¼Œå¯ä»¥ç›´æ¥ç”¨äºç”Ÿäº§ç¯å¢ƒã€‚

---

**åˆ›å»ºæ—¶é—´**ï¼š2025-01-30
**æ–‡ä»¶æ€»æ•°**ï¼š11 ä¸ª
**ä»£ç è¡Œæ•°**ï¼šçº¦ 2000+ è¡Œ
