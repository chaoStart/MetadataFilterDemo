<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tag API æµ‹è¯•é¡µé¢</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }

        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
        }

        .api-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .api-section h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 600;
        }

        input[type="text"],
        textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus,
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            min-height: 100px;
            font-family: 'Courier New', monospace;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        .response {
            margin-top: 15px;
            padding: 15px;
            background: #fff;
            border: 2px solid #ddd;
            border-radius: 5px;
            min-height: 100px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .response.success {
            border-color: #28a745;
            background: #d4edda;
        }

        .response.error {
            border-color: #dc3545;
            background: #f8d7da;
        }

        .small-text {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ·ï¸ Tag API æµ‹è¯•é¡µé¢</h1>

        <!-- å¥åº·æ£€æŸ¥ -->
        <div class="api-section">
            <h2>å¥åº·æ£€æŸ¥</h2>
            <button onclick="healthCheck()">æ£€æŸ¥æœåŠ¡çŠ¶æ€</button>
            <div id="health-response" class="response"></div>
        </div>

        <!-- æ·»åŠ æ ‡ç­¾ -->
        <div class="api-section">
            <h2>æ·»åŠ æ ‡ç­¾</h2>
            <div class="form-group">
                <label>æ–‡æ¡£ID *</label>
                <input type="text" id="add-docid" placeholder="ä¾‹å¦‚: 756063966790811660">
            </div>
            <div class="form-group">
                <label>å…ƒæ•°æ®åˆ—è¡¨ï¼ˆJSONæ•°ç»„ï¼‰</label>
                <input type="text" id="add-metadata" placeholder='ä¾‹å¦‚: ["sc235aw", "235awäº§å“æ‰‹å†Œ", "NT6000æ–‡æ¡£"]'>
            </div>
            <div class="form-group">
                <label>æ–‡ä»¶å</label>
                <input type="text" id="add-filename" placeholder="ä¾‹å¦‚: 235aw.pdf">
            </div>
            <div class="form-group">
                <label>ä½œè€…</label>
                <input type="text" id="add-author" placeholder="ä¾‹å¦‚: ç ”å‘ç®¡ç†éƒ¨é—¨">
            </div>
            <div class="form-group">
                <label>æ—¥æœŸæ—¶é—´</label>
                <input type="text" id="add-datetime" placeholder="ä¾‹å¦‚: 2025-01-10 10:30:00">
            </div>
            <button onclick="addTag()">æ·»åŠ æ ‡ç­¾</button>
            <div id="add-response" class="response"></div>
        </div>

        <!-- æŸ¥è¯¢å’Œåˆ é™¤ -->
        <div class="grid">
            <!-- æŸ¥è¯¢æ ‡ç­¾ -->
            <div class="api-section">
                <h2>æŸ¥è¯¢æ ‡ç­¾</h2>
                <div class="form-group">
                    <label>æ–‡æ¡£ID *</label>
                    <input type="text" id="get-docid" placeholder="ä¾‹å¦‚: 756063966790811660">
                </div>
                <button onclick="getTag()">æŸ¥è¯¢æ ‡ç­¾</button>
                <div id="get-response" class="response"></div>
            </div>

            <!-- åˆ é™¤æ ‡ç­¾ -->
            <div class="api-section">
                <h2>åˆ é™¤æ ‡ç­¾</h2>
                <div class="form-group">
                    <label>æ–‡æ¡£ID *</label>
                    <input type="text" id="delete-docid" placeholder="ä¾‹å¦‚: 756063966790811660">
                </div>
                <button onclick="deleteTag()">åˆ é™¤æ ‡ç­¾</button>
                <div id="delete-response" class="response"></div>
            </div>
        </div>

        <!-- æ›´æ–°æ ‡ç­¾ -->
        <div class="api-section">
            <h2>æ›´æ–°æ ‡ç­¾</h2>
            <div class="form-group">
                <label>æ–‡æ¡£ID *</label>
                <input type="text" id="update-docid" placeholder="ä¾‹å¦‚: 756063966790811660">
            </div>
            <div class="form-group">
                <label>å…ƒæ•°æ®åˆ—è¡¨ï¼ˆJSONæ•°ç»„ï¼‰</label>
                <input type="text" id="update-metadata" placeholder='ä¾‹å¦‚: ["sc235Aw", "231AWäº§å“æ‰‹å†Œ"]'>
            </div>
            <div class="form-group">
                <label>æ–‡ä»¶å</label>
                <input type="text" id="update-filename" placeholder="ä¾‹å¦‚: sc235AWäº§å“æ‰‹å†Œ.pdf">
            </div>
            <div class="form-group">
                <label>ä½œè€…</label>
                <input type="text" id="update-author" placeholder="ä¾‹å¦‚: ç ”å‘ç®¡ç†éƒ¨é—¨">
            </div>
            <div class="form-group">
                <label>æ—¥æœŸæ—¶é—´</label>
                <input type="text" id="update-datetime" placeholder="ä¾‹å¦‚: 2025-02-01 00:00:00">
            </div>
            <button onclick="updateTag()">æ›´æ–°æ ‡ç­¾</button>
            <div id="update-response" class="response"></div>
        </div>

        <!-- æ‰¹é‡æ“ä½œ -->
        <div class="api-section">
            <h2>æ‰¹é‡æ·»åŠ æ ‡ç­¾</h2>
            <div class="form-group">
                <label>JSON æ•°ç»„</label>
                <textarea id="batch-add-json" placeholder='ä¾‹å¦‚:
[
  {
    "doc_id": "756063966790811660",
    "metadataList": ["sc235aw", "235awäº§å“æ‰‹å†Œ"],
    "filename": "235aw.pdf",
    "author": "ç ”å‘éƒ¨",
    "dateTime": "2025-01-10 10:30:00"
  }
]'></textarea>
            </div>
            <button onclick="batchAddTags()">æ‰¹é‡æ·»åŠ </button>
            <div id="batch-add-response" class="response"></div>
        </div>

        <div class="api-section">
            <h2>æ‰¹é‡åˆ é™¤æ ‡ç­¾</h2>
            <div class="form-group">
                <label>æ–‡æ¡£IDåˆ—è¡¨ï¼ˆé€—å·åˆ†éš”ï¼‰</label>
                <input type="text" id="batch-delete-ids" placeholder="ä¾‹å¦‚: 756063966790811660,756063966790811661">
            </div>
            <button onclick="batchDeleteTags()">æ‰¹é‡åˆ é™¤</button>
            <div id="batch-delete-response" class="response"></div>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:8080/api/tags';

        function displayResponse(elementId, data, isSuccess = true) {
            const element = document.getElementById(elementId);
            element.textContent = JSON.stringify(data, null, 2);
            element.className = 'response ' + (isSuccess ? 'success' : 'error');
        }

        async function healthCheck() {
            try {
                const response = await fetch(`${API_BASE_URL}/health`);
                const data = await response.json();
                displayResponse('health-response', data, response.ok);
            } catch (error) {
                displayResponse('health-response', { error: error.message }, false);
            }
        }

        async function addTag() {
            const docId = document.getElementById('add-docid').value;
            const metadataStr = document.getElementById('add-metadata').value;
            const filename = document.getElementById('add-filename').value;
            const author = document.getElementById('add-author').value;
            const dateTime = document.getElementById('add-datetime').value;

            if (!docId) {
                alert('æ–‡æ¡£IDä¸èƒ½ä¸ºç©º');
                return;
            }

            let metadataList = null;
            if (metadataStr) {
                try {
                    metadataList = JSON.parse(metadataStr);
                } catch (e) {
                    alert('å…ƒæ•°æ®åˆ—è¡¨æ ¼å¼é”™è¯¯ï¼Œè¯·è¾“å…¥æœ‰æ•ˆçš„JSONæ•°ç»„');
                    return;
                }
            }

            const requestBody = {
                doc_id: docId,
                metadataList: metadataList,
                filename: filename || null,
                author: author || null,
                dateTime: dateTime || null
            };

            try {
                const response = await fetch(`${API_BASE_URL}/add`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestBody)
                });
                const data = await response.json();
                displayResponse('add-response', data, response.ok);
            } catch (error) {
                displayResponse('add-response', { error: error.message }, false);
            }
        }

        async function getTag() {
            const docId = document.getElementById('get-docid').value;

            if (!docId) {
                alert('æ–‡æ¡£IDä¸èƒ½ä¸ºç©º');
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/get/${docId}`);
                const data = await response.json();
                displayResponse('get-response', data, response.ok);
            } catch (error) {
                displayResponse('get-response', { error: error.message }, false);
            }
        }

        async function deleteTag() {
            const docId = document.getElementById('delete-docid').value;

            if (!docId) {
                alert('æ–‡æ¡£IDä¸èƒ½ä¸ºç©º');
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/delete/${docId}`, {
                    method: 'DELETE'
                });
                const data = await response.json();
                displayResponse('delete-response', data, response.ok);
            } catch (error) {
                displayResponse('delete-response', { error: error.message }, false);
            }
        }

        async function updateTag() {
            const docId = document.getElementById('update-docid').value;
            const metadataStr = document.getElementById('update-metadata').value;
            const filename = document.getElementById('update-filename').value;
            const author = document.getElementById('update-author').value;
            const dateTime = document.getElementById('update-datetime').value;

            if (!docId) {
                alert('æ–‡æ¡£IDä¸èƒ½ä¸ºç©º');
                return;
            }

            let metadataList = null;
            if (metadataStr) {
                try {
                    metadataList = JSON.parse(metadataStr);
                } catch (e) {
                    alert('å…ƒæ•°æ®åˆ—è¡¨æ ¼å¼é”™è¯¯ï¼Œè¯·è¾“å…¥æœ‰æ•ˆçš„JSONæ•°ç»„');
                    return;
                }
            }

            const requestBody = {
                doc_id: docId,
                metadataList: metadataList,
                filename: filename || null,
                author: author || null,
                dateTime: dateTime || null
            };

            try {
                const response = await fetch(`${API_BASE_URL}/update`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestBody)
                });
                const data = await response.json();
                displayResponse('update-response', data, response.ok);
            } catch (error) {
                displayResponse('update-response', { error: error.message }, false);
            }
        }

        async function batchAddTags() {
            const jsonStr = document.getElementById('batch-add-json').value;

            if (!jsonStr) {
                alert('è¯·è¾“å…¥JSONæ•°ç»„');
                return;
            }

            let requestBody;
            try {
                requestBody = JSON.parse(jsonStr);
            } catch (e) {
                alert('JSONæ ¼å¼é”™è¯¯: ' + e.message);
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/batch-add`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestBody)
                });
                const data = await response.json();
                displayResponse('batch-add-response', data, response.ok);
            } catch (error) {
                displayResponse('batch-add-response', { error: error.message }, false);
            }
        }

        async function batchDeleteTags() {
            const idsStr = document.getElementById('batch-delete-ids').value;

            if (!idsStr) {
                alert('è¯·è¾“å…¥æ–‡æ¡£IDåˆ—è¡¨');
                return;
            }

            const docIds = idsStr.split(',').map(id => id.trim()).filter(id => id);

            if (docIds.length === 0) {
                alert('æ²¡æœ‰æœ‰æ•ˆçš„æ–‡æ¡£ID');
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/batch-delete`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(docIds)
                });
                const data = await response.json();
                displayResponse('batch-delete-response', data, response.ok);
            } catch (error) {
                displayResponse('batch-delete-response', { error: error.message }, false);
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ‰§è¡Œå¥åº·æ£€æŸ¥
        window.onload = function() {
            healthCheck();
        };
    </script>
</body>
</html>
